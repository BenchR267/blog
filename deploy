#!/bin/bash

set -e

function separator {
	echo '=========================='
}

now=`date +%s`

echo "Building the site: $now"
separator
hugo
separator
echo "Removing old version"
separator
ssh benchr@bootes.uberspace.de 'rm -rf subdomains/blog.benchr.de/*'

echo "Uploading generated files"
separator
scp -qr public/* benchr@bootes.uberspace.de:subdomains/blog.benchr.de/
scp -qr .well-known benchr@bootes.uberspace.de:subdomains/blog.benchr.de/

echo "Creating and pushing tag"
separator
git tag "$now"
git push --tags

separator
echo "Done!"
